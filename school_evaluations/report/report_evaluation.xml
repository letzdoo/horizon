<?xml version="1.0" encoding="utf-8" ?>
<!--
##############################################################################
#
#    Copyright (c) 2023 ito-invest.lu
#                       Jerome Sonnet <jerome.sonnet@ito-invest.lu>
#
#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU Affero General Public License as
#    published by the Free Software Foundation, either version 3 of the
#    License, or (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU Affero General Public License for more details.
#
#    You should have received a copy of the GNU Affero General Public License
#    along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
##############################################################################
-->
<odoo>

    <!--
    
    Success Certificate
    
    -->
    
    <record id="report_success_certificate" model="ir.actions.report">
        <field name="name">Success Certificate</field>
        <field name="model">school.individual_bloc</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">school_evaluations.report_success_certificate_content</field>
        <field name="report_file">school_evaluations.report_success_certificate_content</field>
        <field name="print_report_name">object.name+'-CERT-'+time.strftime('%d-%m-%Y')+'.pdf'</field>
        <field name="binding_model_id" ref="model_school_individual_bloc"/>
        <field name="binding_type">report</field>
    </record>

    <!--Email template -->
    <record id="email_template_success_certificate" model="mail.template">
        <field name="name">Sucess Certificate - Send by Email</field>
        <field name="email_to">${(object.student_id.email and '%s &lt;%s&gt;' % (object.student_id.name, object.student_id.email) or '')|safe}</field>
        <field name="subject">Sucess Certificate</field>
        <field name="partner_to">${object.student_id.id}</field>
        <field name="model_id" ref="model_school_individual_bloc" />
        <field name="auto_delete" eval="True" />
        <field name="report_template" ref="report_success_certificate" />
        <field name="report_name">Sucess Certificate</field>
        <field name="lang">${object.student_id.lang}</field>
        <field name="body_html">
            <![CDATA[
                <div style="font-family: 'Lucida Grande', Ubuntu, Arial, Verdana, sans-serif; font-size: 12px; color: rgb(34, 34, 34); background-color: #FFF; ">
                    <p>Hello ${object.student_id.name},</p>
                    <br/>
                    <p>Your Success Certificate is attached to this email. </p>
                    <br/>
                    <p>If you have any question, do not hesitate to contact us.</p>
                    <br/>
                </div>
            ]]>
        </field>
    </record>

    <template id="report_success_certificate_content">
        <t t-call="web.html_container">
            <t t-set="data_report_margin_top" t-value="40"/>
            <t t-set="data_report_header_spacing" t-value="35"/>
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                  <div class="page">
                    <div class="container" style="padding-right:70px;padding-left:70px;">
                        <div class="row" style="margin-bottom:30px;">
                            <div class="col-12 text-center">
                                <h3>ATTESTATION DE RÉUSSITE</h3>
                                <h3>Conservatoire royal de Liège<br/>Boulevard Piercot, 29, 4000 LIÈGE</h3>
                                <h4>Domaine : <span t-field="o.source_bloc_domain_id.long_name"/></h4>
                            </div>
                        </div>
                        <div style="font-size:20px;">
                          <t t-if="o.state in ['draft', 'postponed', 'failed']">
                          <div class="alert alert-danger" role="alert">Programme non réussi, actuellement au stade de : <span t-field="o.state"/></div>
                          </t>
                          <div class="row" style="margin-top:200px;">
                              <div class="col-12 text-center">
                                  Je soussigné, NATHANAËL HARCQ, Directeur du Conservatoire Royal de Liège, certifie que
                              </div>
                          </div>
                          <div class="row" style="margin-top:60px;">
                              <div class="col-12 text-center">
                                  <t t-if="o.student_id.gender == 'male'">Monsieur</t><t t-if="o.student_id.gender == 'female'">Madame</t> <span t-field="o.student_id"/> <span t-field="o.student_id.initials"/><br/>
                                  <br/>
                                  Né<t t-if="o.student_id.gender == 'female'">e</t> à <span t-field="o.student_id.birthplace"/> le <span t-field="o.student_id.birthdate_date"/><br/>
                                  <br/>
                                  A réussi en l’année académique <span t-field="o.year_id"/><br/>
                                  son programme en <span t-field="o.source_bloc_domain_id"/> option <span t-field="o.source_bloc_speciality_id"/> pour un total de <span t-field="o.total_acquiered_credits"/> ECTS.
                              </div>
                          </div>
                          <div class="row" style="margin-top:60px;" t-if="o.total_acquiered_credits &lt; o.total_credits">
                              <div class="col-12 text-center">
                                  Un complément de <span t-esc="o.total_credits-o.total_acquiered_credits"/> reste(nt) à obtenir pour compléter le programme.
                              </div>
                          </div>
                          <div class="row" style="margin-top:50px;">
                              <div class="col-10">
                                  La présente attestation est délivrée pour renseignements administratifs.
                              </div>
                          </div>
                          <div class="row" style="margin-top:60px;">
                              <div class="col-6">
                                  Le Directeur
                              </div>
                          </div>
                          <div class="row" style="margin-top:80px;">
                              <div class="col-6">
                                  NATHANAËL HARCQ
                              </div>
                          </div>
                        </div>
                    </div>
                </div>
                </t>
            </t>
        </t>
    </template>

    <!--
    
    Success Certificate on programs
    
    -->

    <record id="report_success_certificate_prog" model="ir.actions.report">
        <field name="name">Success Certificate</field>
        <field name="model">school.individual_program</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">school_evaluations.report_success_certificate_prog_content</field>
        <field name="report_file">school_evaluations.report_success_certificate_prog_content</field>
        <field name="print_report_name">object.name+'-CERT-'+time.strftime('%d-%m-%Y')+'.pdf'</field>
        <field name="binding_model_id" ref="model_school_individual_program"/>
        <field name="binding_type">report</field>
        <field name="attachment_use">True</field>
    </record>

    <!--Email template -->
    <record id="email_template_success_certificate_prog" model="mail.template">
        <field name="name">Sucess Certificate - Send by Email</field>
        <field name="email_to">${(object.student_id.email and '%s &lt;%s&gt;' % (object.student_id.name, object.student_id.email) or '')|safe}</field>
        <field name="subject">Sucess Certificate</field>
        <field name="partner_to">${object.student_id.id}</field>
        <field name="model_id" ref="model_school_individual_program" />
        <field name="auto_delete" eval="True" />
        <field name="report_template" ref="report_success_certificate_prog" />
        <field name="report_name">Sucess Certificate</field>
        <field name="lang">${object.student_id.lang}</field>
        <field name="body_html">
            <![CDATA[
                <div style="font-family: 'Lucida Grande', Ubuntu, Arial, Verdana, sans-serif; font-size: 12px; color: rgb(34, 34, 34); background-color: #FFF; ">
                    <p>Hello ${object.student_id.name},</p>
                    <br/>
                    <p>Your Success Certificate is attached to this email. </p>
                    <br/>
                    <p>If you have any question, do not hesitate to contact us.</p>
                    <br/>
                </div>
            ]]>
        </field>
    </record>

    <template id="report_success_certificate_prog_content">
        <t t-call="web.html_container">
            <t t-set="data_report_margin_top" t-value="40" />
            <t t-set="data_report_header_spacing" t-value="35" />
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                <div class="page">
                    <div class="container" style="padding-right:70px;padding-left:70px;">
                        <div class="row" style="margin-bottom:30px;">
                            <div class="col-12 text-center">
                                <h3>ATTESTATION DE RÉUSSITE DE CYCLE</h3>
                                <h3>Conservatoire royal de Liège<br
                                        />Boulevard Piercot, 29, 4000 LIÈGE</h3>
                                <h4>Domaine : <span
                                            t-field="o.domain_id.long_name"
                                        /></h4>
                            </div>
                        </div>
                        <div style="font-size:20px;">
                          <t t-if="o.state in ['draft', 'progress', 'abandonned']">
                          <div
                                        class="alert alert-danger"
                                        role="alert"
                                    >Cycle non réussi, actuellement au stade de : <span
                                            t-field="o.state"
                                        /></div>
                          </t>
                          <div class="row" style="margin-top:200px;">
                              <div class="col-12 text-center">
                                  Je soussigné, NATHANAËL HARCQ, Directeur du Conservatoire Royal de Liège, certifie que
                              </div>
                          </div>
                          <div class="row" style="margin-top:60px;">
                              <div class="col-12 text-center">
                                  <t t-if="o.student_id.gender == 'male'">Monsieur</t><t
                                            t-if="o.student_id.gender == 'female'"
                                        >Madame</t> <span
                                            t-field="o.student_id"
                                        /> <span t-field="o.student_id.initials" /><br
                                        />
                                  <br />
                                  Né<t
                                            t-if="o.student_id.gender == 'female'"
                                        >e</t> à <span
                                            t-field="o.student_id.birthplace"
                                        /> le <span
                                            t-field="o.student_id.birthdate_date"
                                        /><br />
                                  <br />
                                  A réussi en l’année académique <span
                                            t-field="o.grade_year_id"
                                        /> le <span
                                            t-esc="o.source_program_id.title.lower()"
                                        />
                                  <br /><t t-if="o.grade == 'without'"><span
                                                t-field="o.grade"
                                            /></t><t
                                            t-if="o.grade != 'without'"
                                        >avec <span t-field="o.grade" /></t>
                                  pour un total de <span
                                            t-field="o.total_acquiered_credits"
                                        /> ECTS.
                              </div>
                          </div>
                          <div class="row" style="margin-top:50px;">
                              <div class="col-10">
                                  La présente attestation est délivrée pour renseignements administratifs.
                              </div>
                          </div>
                          <div class="row" style="margin-top:60px;">
                              <div class="col-6">
                                  Le Directeur
                              </div>
                          </div>
                          <div class="row" style="margin-top:80px;">
                              <div class="col-6">
                                  NATHANAËL HARCQ
                              </div>
                          </div>
                        </div>
                    </div>
                </div>
                </t>
            </t>
        </t>
    </template>

    <!--
    
    Evaluations report for students
    
    -->
        
    <record id="report_evaluation_for_student" model="ir.actions.report">
        <field name="name">Evaluations for student</field>
        <field name="model">school.individual_bloc</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">school_evaluations.report_evaluation_for_student_content</field>
        <field name="report_file">school_evaluations.report_evaluation_for_student_content</field>
        <field name="print_report_name">object.name+'-RES-'+time.strftime('%d-%m-%Y')+'.pdf'</field>
        <field name="binding_model_id" ref="model_school_individual_bloc"/>
        <field name="binding_type">report</field>
        <field name="attachment_use">True</field>
    </record>

    <!--Email template -->
    <record id="email_template_evaluation_for_student" model="mail.template">
        <field name="name">Evaluation Report - Send by Email</field>
        <field name="email_to">${(object.student_id.email and '%s &lt;%s&gt;' % (object.student_id.name, object.student_id.email) or '')|safe}</field>
        <field name="subject">Evaluation Report</field>
        <field name="partner_to">${object.student_id.id}</field>
        <field name="model_id" ref="model_school_individual_bloc" />
        <field name="auto_delete" eval="True" />
        <field name="report_template" ref="report_evaluation_for_student" />
        <field name="report_name">Evaluation Report</field>
        <field name="lang">${object.student_id.lang}</field>
        <field name="body_html">
            <![CDATA[
                <div style="font-family: 'Lucida Grande', Ubuntu, Arial, Verdana, sans-serif; font-size: 12px; color: rgb(34, 34, 34); background-color: #FFF; ">
                    <p>Hello ${object.student_id.name},</p>
                    <br/>
                    <p>Your Evaluation Report is attached to this email. </p>
                    <br/>
                    <p>If you have any question, do not hesitate to contact us.</p>
                    <br/>
                </div>
            ]]>
        </field>
    </record>

    <template id="report_evaluation_for_student_content">
        <t t-call="web.html_container">
            <t t-set="data_report_margin_top" t-value="40"/>
            <t t-set="data_report_header_spacing" t-value="35"/>
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                <div class="page">
                    <div class="container">
                        <div class="row">
                            <div class="col-6 col-offset-6">
                                <address t-field="o.student_id" t-field-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;], &quot;no_marker&quot;: true}"/>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-8 col-offset-1">
                                <h4>Fiche de résultats - <t t-esc="o.name"/></h4>    
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-8 col-offset-1">
                                <h4><t t-esc="o.source_bloc_name"/></h4>    
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-10 col-offset-1">
                                <!-- Table -->
                                <table class="table table-condensed table-bordered result_table">
                                    <colgroup>
                                        <col style="width:500px"/>
                                        <col style="width:75px"/>
                                        <col style="width:75px"/>
                                        <col style="width:75px"/>
                                    </colgroup>
                                    <thead>
                                        <tr>
                                            <th>Intitulé du cours</th>
                                            <th>Résultats</th>
                                            <th>ECTS</th>
                                            <th>Acquis</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="o.course_group_ids" t-as="course_group">
                                            <tr class="course_group">
                                                <td>
                                                    <t t-esc="course_group.title"/>
                                                </td>
                                                <td style=" text-align: right;">
                                                    <t t-esc="course_group.final_result_disp"/>
                                                </td>
                                                <td style=" text-align: right;">
                                                    <t t-esc="course_group.total_credits"/>
                                                </td>
                                                <td>
                                                    <span class="label label-success" t-if="course_group.acquiered == 'A'">Acquis</span>
                                                    <span class="label label-warning" t-if="course_group.acquiered == 'NA'">Non Acquis</span>
                                                </td>
                                            </tr>
                                            <t t-foreach="course_group.course_ids" t-as="course">
                                                <tr style="font-style: italic;font-size:80%;">
                                                    <td>
                                                        <t t-esc="course.title"/> - <t t-esc="course.level"/> <i t-if="course.teacher_id" class="oe_fade"> - <t t-esc="course.teacher_id.name"/><span t-if="not course.source_course_id.has_second_session">*</span></i></td>
                                                    <td style=" text-align: right;">
                                                        <t t-if="course.second_session_result_bool">
                                                            <t t-esc="course.second_session_result_disp"/>
                                                        </t>
                                                        <t t-if="course.second_session_result_bool == False">
                                                            <t t-esc="course.first_session_result_disp"/>
                                                        </t>
                                                    </td>
                                                    <td/>
                                                    <td/>
                                                </tr>
                                            </t>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-10 col-offset-1" style="font-size:small">
                                * Pas de seconde session possible pour cette activité.
                            </div>
                        </div>    
                        <div class="row">
                            <div class="col-10 col-offset-1">
                                <h4>A acquis ou valorisé <t t-esc="o.total_acquiered_credits"/> crédits ECTS. <t t-if="o.total_credits == o.total_acquiered_credits">A réussi l'ensemble de son PAE.</t></h4>
                            </div>
                        </div>
                        <div class="row" style="margin-bottom:80px;">
                            <div class="col-10 col-offset-1">
                                Remarques : 
                            </div>
                        </div>
                        <div class="row" style="margin-bottom:120px;">
                            <div class="col-4 col-offset-1">
                                Le Directeur,
                            </div>
                            <div class="col-4">
                                L'étudiant, pour réception, 
                            </div>
                        </div>
                        <div class="row" style="margin-bottom:120px;">
                            <div class="col-9 col-offset-1">
                                Imprimé le <span t-esc="datetime.datetime.now().strftime('%d-%m-%Y à %H:%M:%S')"/>
                            </div>
                        </div>
                    </div>
                </div>
                </t>
            </t>
        </t>
    </template>

    <!--
    
    Evaluations report for deliberation annexe
    
    -->

    <record id="report_deliberation_program_annexe" model="ir.actions.report">
        <field name="name">Deliberation Report Program</field>
        <field name="model">school.individual_program</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">school_evaluations.report_deliberation_annexe_program</field>
        <field name="report_file">school_evaluations.report_deliberation_annexe_program</field>
        <field name="binding_model_id" ref="model_school_individual_program"/>
        <field name="binding_type">report</field>
        <field name="attachment_use">True</field>
    </record>

    <template id="report_deliberation_annexe_program">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
              <t t-foreach="docs" t-as="o">
              <div class="page">
                <div class="container"> 
                  <h2>Rapport de délibération de cycle</h2>
                  <h2><t t-esc="o.student_id.name"/></h2>
                  <h4><t t-esc="o.uid"/> - <t t-esc="o.source_program_id.name"/></h4>
                  <h5>Crédits du cycle obtenus (<t t-esc="o.total_acquiered_credits"/> / <t t-esc="o.source_program_id.total_credits"/>)</h5>
                  <t
                    t-if="o.grade"
                    t-set="student_success_grade"
                    t-value="dict(o.fields_get(allfields=['grade'])['grade']['selection'])[o.grade]"
                  />
                  <h5>Grade obtenu : <t t-esc="student_success_grade"/></h5>
                </div>
                <div class="container"> 
                  <table class="table table-sm">
                      <thead>
                          <tr>
                              <th>UE Id</th>
                              <th>Nom</th>
                              <th>Heures</th>
                              <th>ECTS</th>
                              <th>Résultat final</th>
                              <th>Réussi en</th>
                          </tr>
                      </thead>
                      <tbody>
                          <t t-foreach="o.acquired_ind_course_group_ids" t-as="course_group">
                            <tr class="course_group">
                              <td>
                                  <t t-esc="course_group.uid"/>
                              </td>
                              <td>
                                  <t t-esc="course_group.title"/>
                              </td>
                              <td>
                                  <t t-esc="course_group.total_hours"/>
                              </td>
                              <td>
                                  <t t-esc="course_group.total_credits"/>
                              </td>
                              <td>
                                  <t t-esc="course_group.final_result_disp"/>
                              </td>
                              <td>
                                  <t t-esc="course_group.bloc_id.year_id.name"/>
                              </td>
                            </tr>
                          </t>
                      </tbody>
                  </table>
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            Imprimé le <span t-esc="datetime.datetime.now().strftime('%d-%m-%Y à %H:%M:%S')"/>
                        </div>
                    </div>
                </div>
              </div>
              </t>
            </t>
        </t>
    </template>

    <record id="report_deliberation_annexe" model="ir.actions.report">
        <field name="name">Deliberation Report Annexes</field>
        <field name="model">school.individual_bloc</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">school_evaluations.report_deliberation_annexe_content</field>
        <field name="report_file">school_evaluations.report_deliberation_annexe_content</field>
        <field name="binding_model_id" ref="model_school_individual_bloc"/>
        <field name="binding_type">report</field>
        <field name="attachment_use">True</field>
    </record>

    <template id="report_deliberation_annexe_content">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
              <t t-foreach="docs" t-as="o">
              <div class="page">
                <div class="container"> 
                  <h2>Rapport de délibération du programme annuel de l'étudiant</h2>
                  <h2><t t-esc="o.student_id.name"/></h2>
                  <h4><t t-esc="o.uid"/> - <t t-esc="o.source_bloc_id.name"/></h4>
                  <h5>Crédits du PAE obtenus (<t t-esc="o.total_acquiered_credits"/> / <t t-esc="o.total_credits"/>)</h5>
                  <h5>Décision du jury : <t t-esc="o.decision"/></h5>
                </div>
                <div class="container"> 
                  <table class="table table-sm">
                      <thead>
                          <tr>
                              <th>UE Id</th>
                              <th>Nom</th>
                              <th>Heures</th>
                              <th>ECTS</th>
                              <th>Résultat final</th>
                              <th>Acquis</th>
                          </tr>
                      </thead>
                      <tbody>
                          <t t-foreach="o.course_group_ids" t-as="course_group">
                            <tr class="course_group">
                              <td>
                                  <t t-esc="course_group.uid"/>
                              </td>
                              <td>
                                  <t t-esc="course_group.title"/>
                              </td>
                              <td class="text-center">
                                  <t t-esc="course_group.total_hours"/>
                              </td>
                              <td class="text-center">
                                  <t t-esc="course_group.total_credits"/>
                              </td>
                              <td class="text-center">
                                  <t t-esc="course_group.final_result_disp"/>
                              </td>
                              <td class="text-center">
                                  <t t-esc="course_group.acquiered"/>
                              </td>
                            </tr>
                            <t t-foreach="course_group.course_ids" t-as="course">
                            <tr class="course" style="font-style: italic;font-weight: lighter;font-size: 80%;">
                              <td>
                                  <t t-esc="course.uid"/>
                              </td>
                              <td>
                                  <t t-esc="course.title"/>
                              </td>
                              <td class="text-center">
                                  <t t-esc="course.hours"/>
                              </td>
                              <td class="text-center">
                                  <t t-esc="course.credits"/>
                              </td>
                              <td class="text-center">
                                  <t t-esc="course.final_result_disp"/>
                              </td>
                              <td>
                              </td>
                            </tr>
                            </t>
                          </t>
                      </tbody>
                  </table>
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            Imprimé le <span t-esc="datetime.datetime.now().strftime('%d-%m-%Y à %H:%M:%S')"/>
                        </div>
                    </div>
                </div>
              </div>
              </t>
            </t>
        </t>
    </template>


    <!-- Individual Bloc Definition Report -->

    <record id="report_individual_bloc_definition" model="ir.actions.report">
        <field name="name">Individual Bloc Definition Report</field>
        <field name="model">school.individual_program</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">school_evaluations.report_individual_bloc_definition_content</field>
        <field name="report_file">school_evaluations.report_individual_bloc_definition_content</field>
        <field name="binding_model_id" ref="model_school_individual_program"/>
        <field name="binding_type">report</field>
        <field name="attachment_use">True</field>
    </record>

    <template id="report_individual_bloc_definition_content">
        <t t-set="company" t-value="docs.env.company"/>
        <t t-call="web.report_layout">
            <t t-foreach="docs" t-as="program">
                <div class="header">
                    <img alt="" src="/school_management/static/src/img/HeaderCRLG.png" title=""/>
                </div>
                <div class="article" t-att-data-oe-model="program and program._name" t-att-data-oe-id="program and program.id" t-att-data-oe-lang="program and program.env.context.get('lang')" style="margin: 0cm 1.5cm;">
                    <h1>FICHE DE CYCLE INDIVIDUEL DE L'ÉTUDIANT·E</h1>
                    <h2>Étudiant·e : <t t-esc="program.student_id.name"/></h2>
                    <h4>Cycle : <t t-esc="program.source_program_id.name"/></h4>
                    <h5>Identifiant de cycle individuel : <t t-esc="program.uid"/></h5>
                    <section t-if="program.total_valuated_credits &gt; 0">
                        <div class="pure-g horizon-section-title" style="color:rgb(50, 100, 200);">
                          VALORISATION(S) ACCORDÉE(S) : <t t-esc="program.total_valuated_credits"/> ECTS
                        </div>
                        <table class="pure-table pure-table-horizontal horizon-table">
                            <colgroup>
                                <col style="width:120px"/>
                                <col style="width:630px"/>
                                <col style="width:150px"/>
                                <col style="width:150px"/>
                                <col style="width:150px"/>
                            </colgroup>
                            <thead>
                                <tr>
                                    <th>
                                        CODE UE
                                    </th>
                                    <th>
                                        UNITéS D'ENSEIGNEMENT
                                    </th>
                                    <th class="center">
                                        HEURES
                                    </th>
                                    <th class="center">
                                        ECTS
                                    </th>
                                    <th class="center">
                                        TYPE DE VALORISATION
                                    </th>
                                </tr>
                            </thead>    
                            <t t-foreach="program.valuated_course_group_ids" t-as="course_group">
                            <tr class="major_row">
                                <td>
                                    <t t-esc="course_group.source_course_group_id.uid"/>
                                </td>
                                <td>
                                    <t t-esc="course_group.title"/>
                                </td>
                                <td class="center">
                                    <t t-esc="course_group.source_course_group_id.total_hours"/>
                                </td>
                                <td class="center">
                                    <t t-esc="course_group.source_course_group_id.total_credits"/>
                                </td>
                                <td class="center">
                                    <t t-esc="course_group.valuation_followup.valuation_type if course_group.valuation_followup else ''"/>
                                </td>
                            </tr>
                            </t>
                        </table>
                    </section>
                    <section>
                        <div class="pure-g horizon-section-title" style="color:rgb(100, 165, 60);">
                          CRÉDITS OBTENUS : <t t-esc="program.total_acquiered_credits - program.total_valuated_credits"/> / <t t-esc="program.source_program_id.total_credits - program.total_valuated_credits"/> Crédits
                        </div>
                        <table class="pure-table pure-table-horizontal horizon-table" t-if="(program.total_acquiered_credits - program.total_valuated_credits) &gt; 0">
                            <colgroup>
                                <col style="width:120px"/>
                                <col style="width:630px"/>
                                <col style="width:100px"/>
                                <col style="width:100px"/>
                                <col style="width:100px"/>
                                <!--<col style="width:80px"/>-->
                                <col style="width:150px"/>
                                <!--<col style="width:180px"/>
                                <col style="width:180px"/>-->
                            </colgroup>
                            <thead>
                                <tr>
                                    <th>UE Id</th>
                                    <th>Nom</th>
                                    <th class="center">Heures</th>
                                    <th class="center">ECTS</th>
                                    <th class="center">Résultat final</th>
                                    <!--<th class="center">ECTS acquis</th>-->
                                    <th>Origine</th>
                                    <!--<th>Avis pédagogique</th>
                                    <th>Décision jury</th>-->
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="program.ind_course_group_ids.filtered(lambda ic: ic.acquiered == 'A')" t-as="course_group">
                                    <tr class="major_row">
                                        <td>
                                            <t t-esc="course_group.source_course_group_id.uid"/>
                                        </td>
                                        <td>
                                            <t t-esc="course_group.title"/>
                                        </td>
                                        <td class="center">
                                            <t t-esc="course_group.total_hours"/>
                                        </td>
                                        <td class="center">
                                            <t t-esc="course_group.total_credits"/>
                                        </td>
                                        <td class="center">
                                            <t t-esc="course_group.final_result_disp"/>
                                        </td>
                                        <!--<td class="center">
                                            <t t-esc="course_group.total_credits"/>
                                        </td>-->
                                        <td>
                                            <t t-if="course_group.bloc_id">
                                            PAE <t t-esc="course_group.bloc_id.year_id.name"/>
                                            </t>
                                            <t t-if="not course_group.bloc_id and course_group.state == 'candidate'">
                                            Attente
                                            </t>
                                            <t t-if="not course_group.bloc_id and course_group.state == 'confirmed'">
                                            Valorisation
                                            </t>
                                        </td>
                                        <!--<td>
                                            <span/>
                                        </td>
                                        <td>
                                            <span/>
                                        </td>-->
                                    </tr>
                                    <t t-foreach="course_group.course_ids" t-as="course">
                                    <tr class="minor_row">
                                        <td>
                                            <span/>
                                        </td>
                                        <td>
                                            <i><t t-esc="course.title"/></i>
                                        </td>
                                        <td class="center">
                                            <i><t t-esc="course.hours"/></i>
                                        </td>
                                        <td class="center">
                                            <i><t t-esc="course.credits"/></i>
                                        </td>
                                        <td class="center">
                                            <i><t t-if="course.second_session_result_bool">
                                                <t t-esc="course.second_session_result_disp"/>
                                            </t>
                                            <t t-if="not course.second_session_result_bool">
                                                <t t-esc="course.first_session_result_disp"/>
                                            </t></i>
                                        </td>
                                        <td>
                                            <span/>
                                        </td>
                                    </tr>
                                    </t>
                                </t>
                            </tbody>
                        </table>
                    </section>
                    <section t-if="len(program.bloc_ids) &gt; 0">
                      <div class="pure-g horizon-section-title" style="color:rgb(255, 180, 15);">
                          PAE EN COURS : <t t-esc="program.bloc_ids[-1].uid"/> de <t t-esc="program.bloc_ids[-1].total_credits"/> Crédits<br/>
                          (année académique <t t-esc="program.bloc_ids[-1].year_id.name"/>)
                      </div>
                      <table class="pure-table pure-table-horizontal horizon-table">
                          <colgroup>
                              <col style="width:120px"/>
                              <col style="width:480px"/>
                              <col style="width:100px"/>
                              <col style="width:100px"/>
                              <col style="width:100px"/>
                              <col style="width:100px"/>
                              <col style="width:200px"/>
                          </colgroup>
                          <thead>
                              <tr>
                                  <th>UE Id</th>
                                  <th>Nom</th>
                                  <th class="center">Heures</th>
                                  <th class="center">ECTS</th>
                                  <th class="center">Résultat final</th>
                                  <th class="center">ECTS acquis</th>
                                  <th>Commentaire</th>
                              </tr>
                          </thead>
                          <tbody>
                              <t t-foreach="program.bloc_ids[-1].course_group_ids" t-as="course_group">
                                  <tr class="major_row">
                                      <td>
                                          <t t-esc="course_group.source_course_group_id.uid"/>
                                      </td>
                                      <td>
                                          <t t-esc="course_group.title"/>
                                      </td>
                                      <td class="center">
                                          <t t-esc="course_group.total_hours"/>
                                      </td>
                                      <td class="center">
                                          <t t-esc="course_group.total_credits"/>
                                      </td>
                                      <td class="center">
                                          <t t-if="course_group.final_result_bool">
                                              <t t-esc="course_group.final_result_disp"/>
                                          </t>
                                      </td>
                                      <td class="center">
                                          <t t-if="course_group.acquiered == 'A'">
                                              Acquis
                                          </t>
                                          <t t-if="course_group.acquiered  == 'NA'">
                                              Non-Acquis
                                          </t>
                                      </td>
                                      <td>
                                          <span/>
                                      </td>
                                  </tr>
                                  <t t-foreach="course_group.course_ids" t-as="course">
                                  <tr class="minor_row">
                                      <td>
                                          <span/>
                                      </td>
                                      <td>
                                          <i><t t-esc="course.title"/></i>
                                      </td>
                                      <td class="center">
                                          <i><t t-esc="course.hours"/></i>
                                      </td>
                                      <td class="center">
                                          <i><t t-esc="course.credits"/></i>
                                      </td>
                                      <td class="center">
                                          <i><t t-if="course.second_session_result_bool">
                                              <t t-esc="course.second_session_result_disp"/>
                                          </t>
                                          <t t-if="not course.second_session_result_bool">
                                              <t t-esc="course.first_session_result_disp"/>
                                          </t></i>
                                      </td>
                                      <td>
                                          <span/>
                                      </td>
                                      <td>
                                          <span/>
                                      </td>
                                  </tr>
                                  </t>
                            </t>
                          </tbody>
                      </table>
                    </section>
                    <section>
                      <div class="pure-g horizon-section-title" style="color:#444444;">
                        CRÉDITS À ACQUÉRIR : <t t-esc="sum(program.remaining_not_planned_course_group_ids.mapped('total_credits'))"/> Crédits
                      </div>
                      <table class="pure-table pure-table-horizontal horizon-table">
                          <colgroup>
                              <col style="width:120px"/>
                              <col style="width:500px"/>
                              <col style="width:100px"/>
                              <col style="width:100px"/>
                              <col style="width:380px"/>
                          </colgroup>
                          <thead>
                              <tr>
                                  <th>UE Id</th>
                                  <th>Nom</th>
                                  <th class="center">Heures</th>
                                  <th class="center">ECTS</th>
                                  <th>Commentaire</th>
                              </tr>
                          </thead>
                          <tbody>
                              <t t-foreach="program.remaining_not_planned_course_group_ids" t-as="course_group">
                                  <tr class="major_row">
                                      <td>
                                          <t t-esc="course_group.uid"/>
                                      </td>
                                      <td>
                                          <t t-esc="course_group.title"/>
                                      </td>
                                      <td class="center">
                                          <t t-esc="course_group.total_hours"/>
                                      </td>
                                      <td class="center">
                                          <t t-esc="course_group.total_credits"/>
                                      </td>
                                      <td>
                                          <span/>
                                      </td>
                                  </tr>
                            </t>
                          </tbody>
                      </table>
                    </section>
                    <section>
                      <div class="pure-g" style="margin-left:60px;margin-right:60px;page-break-before:always;">
                          <span />
                      </div>
                    </section>
                </div>
            </t>
        </t>
    </template>


    <!--
    
    Evaluations by Teacher
    
    -->

    <!-- report -->
    <record id="school_evaluation_report_view" model="ir.ui.view">
        <field name="name">Evaluation by Teacher</field>
        <field name="model">school_evaluations.report_evaluation_by_teacher</field>
        <field name="arch" type="xml">
            <form string="Evaluations by teatcher">
                <group col="4">
                    <field name="year_id" create="false" delete="false" colspan="4"/>
                    <field name="teacher_ids" colspan="4"/>
                    <field name="display_results"/>
                    <field name="freeze_first_session"/>
                    <field name="send_as_email"/>
                </group>

                <group attrs="{'invisible':[('send_as_email','=',True)]}" col="1">
                        <h3>Message</h3>
                        <field name="message" nolabel="1" />
                </group>        
                <footer>
                    <button name="print_report" string="Print" type="object" default_focus="1" class="oe_highlight" /> or
                    <button string="Cancel" class="oe_link" special="cancel" />
                </footer>
            </form>
        </field>
    </record>
    
    <!-- email template 
    
    <record id="mail_template_evaluation_email" model="mail.template">
        <field name="name">Evaluation report</field>
        <field name="model_id" ref="res.partner"/>
        <field name="subject">Rapport de validation des évaluations</field>
        <field name="email_to">${object.user_id.email_formatted | safe}</field>
        <field name="body_html" type="html">
            Bonjour,<br/>
            Vous pouvez trouver attaché le rapport de l'encodage de vos évaluations dans Horizon.<br/>
            <br/>
            Cordialement,<br/>
            <br/>
            L'équipe Horizon.
        </field>
        <field name="lang">${object.lang}</field>
        <field name="auto_delete" eval="True"/>
        <field name="user_signature" eval="False"/>
    </record> -->
    
    <record id="report_evaluation_by_teacher" model="ir.actions.report">
        <field name="name">Evaluation by Teacher</field>
        <field name="model">school.individual_course</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">school_evaluations.report_evaluation_by_teacher_content</field>
        <field name="report_file">school_evaluations.report_evaluation_by_teacher_content</field>
        <field name="binding_model_id" ref="model_school_individual_course"/>
        <field name="binding_type">report</field>
        <field name="attachment_use">True</field>
    </record>

    <record id="action_evaluation_report_by_teacher" model="ir.actions.act_window">
        <field name="name">Evaluations by teatcher</field>
        <field name="res_model">school_evaluations.report_evaluation_by_teacher</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="school_evaluation_report_view" />
        <field name="target">new</field>
        <field name="context">{'default_teacher_id': '${object.id or \'\'}'}</field>
    </record>

    <menuitem id="menu_evaluation_report_by_teacher" name="Evaluation by Teacher" action="action_evaluation_report_by_teacher" parent="menu_main_evaluation" sequence="900" /> 

    <!--  Add wizard -->

    <template id="report_evaluation_by_teacher_content">
        <t t-call="web.html_container">
            <t t-set="data_report_margin_top" t-value="55" />
            <t t-set="data_report_header_spacing" t-value="45" />
            <t t-foreach="data" t-as="item">
                <t t-call="web.external_layout">
                <t t-set="input_counter" t-value="1"/>
                <div class="page">
                        <t t-set="teacher" t-value="item['teacher_id']" />
                        <div class="container">
                            <t t-foreach="item['courses']" t-as="course_item">
                                <t t-set="course" t-value="course_item['course']" />
                                <div class="panel panel-default" style="page-break-before:always;">
                                    <!-- Default panel contents -->
                                    <div class="panel-heading">
                                        <h3><t t-esc="teacher.name" /> - <t t-esc="course.name"/></h3>
                                    </div>
                                    <div class="panel-body">
                                        <p>
                                            <t t-esc="message" />
                                        </p>
                                    </div>
                                    <!-- Table -->
                                    <table class="table table-bordered">
                                        <thead>
                                            <colgroup>
                                                <col style="width:2px" />
                                                <col style="width:10px" />
                                                <col style="width:10px" />
                                                <col style="width:5px" t-if="course.type in ['C']"/>
                                                <col style="width:5px" t-if="course.type in ['C','T']"/>
                                                <col style="width:5px" />
                                                <col style="width:5px" />
                                                <col style="width:50px" />
                                            </colgroup>
                                            <tr>
                                                <th>Row</th>
                                                <th>Last Name</th>
                                                <th>First Name</th>
                                                <th t-if="course.type in ['C']">Ann</th>
                                                <th t-if="course.type in ['C','T']">Jan</th>
                                                <th>Jun</th>
                                                <th>Sept</th>
                                                <th>Comments</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-set="counter" t-value="1"/>
                                            <t t-foreach="course_item['individual_courses']" t-as="course">
                                                <tr>
                                                    <td>
                                                        <t t-esc="counter" />
                                                    </td>
                                                    <td>
                                                        <t t-esc="course.student_id.lastname" />
                                                    </td>
                                                    <td>
                                                        <t t-esc="course.student_id.firstname" />
                                                    </td>
                                                    <td t-if="course.source_course_id.type in ['C']">
                                                        <t t-if="display_results == True and freeze_first_session == False">
                                                            <input type="text"  size="6" t-att-name="'input-%i' % input_counter" t-att-value="course.ann_result"/>
                                                        </t>
                                                        <t t-if="display_results == True and freeze_first_session == True">
                                                            <t t-esc="course.ann_result"/>
                                                        </t>
                                                        <t t-if="display_results != True">
                                                            <input type="text"  size="6" t-att-name="'input-%i' % input_counter"/>
                                                        </t>
                                                        <t t-set="input_counter" t-value="input_counter + 1"/>
                                                    </td>
                                                    <td t-if="course.source_course_id.type in ['C','T']">
                                                        <t t-if="display_results == True and freeze_first_session == False">
                                                            <input type="text"  size="6" t-att-name="'input-%i' % input_counter" t-att-value="course.jan_result"/>
                                                        </t>
                                                        <t t-if="display_results == True and freeze_first_session == True">
                                                            <t t-esc="course.jan_result"/>
                                                        </t>
                                                        <t t-if="display_results != True">
                                                            <input type="text"  size="6" t-att-name="'input-%i' % input_counter"/>
                                                        </t>
                                                        <t t-set="input_counter" t-value="input_counter + 1"/>
                                                    </td>
                                                    <td>
                                                        <t t-if="display_results == True and freeze_first_session == False">
                                                            <input type="text"  size="6" t-att-name="'input-%i' % input_counter" t-att-value="course.jun_result"/>
                                                        </t>
                                                        <t t-if="display_results == True and freeze_first_session == True">
                                                            <t t-esc="course.jun_result"/>
                                                        </t>
                                                        <t t-if="display_results != True">
                                                            <input type="text"  size="6" t-att-name="'input-%i' % input_counter"/>
                                                        </t>
                                                        <t t-set="input_counter" t-value="input_counter + 1"/>
                                                    </td>
                                                    <td>
                                                        <t t-if="display_results == True">
                                                            <input type="text"  size="6" t-att-name="'input-%i' % input_counter" t-att-value="course.sept_result"/>
                                                        </t>
                                                        <t t-if="display_results != True">
                                                            <input type="text"  size="6" t-att-name="'input-%i' % input_counter"/>
                                                        </t>
                                                        <t t-set="input_counter" t-value="input_counter + 1"/>
                                                    </td>
                                                    <td></td>
                                                </tr>
                                                <t t-set="counter" t-value="counter + 1"/>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>
                            </t>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>
</odoo>
